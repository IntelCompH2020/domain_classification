from PyQt5.QtCore import QObject, pyqtSignal, pyqtSlot
import sys
from PyQt5 import QtWidgets, QtGui, QtCore


class OutputWrapper(QtCore.QObject):
    outputWritten = QtCore.pyqtSignal(str)

    def __init__(self, parent, stdout=True):
        super().__init__(parent)
        if stdout:
            self._stream = sys.stdout
            sys.stdout = self
        else:
            self._stream = sys.stderr
            sys.stderr = self
        self._stdout = stdout

    def write(self, text):
        self._stream.write(text)
        self.outputWritten.emit(text)

    def __getattr__(self, name):
        return getattr(self._stream, name)

    def __del__(self):
        try:
            if self._stdout:
                sys.stdout = self._stream
            else:
                sys.stderr = self._stream
        except AttributeError:
            pass
